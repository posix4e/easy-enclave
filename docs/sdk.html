<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python SDK - EasyEnclave</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
</head>
<body>
  <div class="grid-bg"></div>
  <div class="scanlines"></div>

  <nav>
    <a href="index.html" class="logo">EASYENCLAVE</a>
    <ul class="nav-links">
      <li><a href="quickstart.html">Quickstart</a></li>
      <li><a href="concepts.html">Concepts</a></li>
      <li><a href="sdk.html">SDK</a></li>
      <li><a href="action.html">GitHub Action</a></li>
      <li><a href="https://github.com/anthropics/easyenclave" target="_blank">GitHub</a></li>
    </ul>
  </nav>

  <main class="docs-container">
    <h1>// PYTHON SDK</h1>
    <p>Connect to attested services with verified TDX quotes.</p>

    <h2>Installation</h2>
    <pre data-lang="bash"><code>pip install easyenclave</code></pre>

    <h2>Quick Example</h2>
    <pre data-lang="python"><code><span class="keyword">from</span> easyenclave <span class="keyword">import</span> connect

<span class="comment"># Connect to an attested service</span>
client = <span class="function">connect</span>(<span class="string">"owner/repo"</span>)

<span class="comment"># Use like any HTTP client</span>
response = client.<span class="function">get</span>(<span class="string">"/api/data"</span>)
print(response.json())</code></pre>

    <h2>API Reference</h2>

    <h3>connect(repo, **options)</h3>
    <p>Connect to an attested service and return a verified HTTP client.</p>

    <pre data-lang="python"><code><span class="function">connect</span>(
    repo: str,                    <span class="comment"># "owner/repo" format</span>
    release: str = <span class="string">"latest"</span>,     <span class="comment"># Release tag or "latest"</span>
    require_sealed: bool = True,  <span class="comment"># Reject unsealed VMs</span>
    timeout: int = 30,            <span class="comment"># Connection timeout</span>
) -> VerifiedClient</code></pre>

    <h4>Parameters</h4>
    <ul>
      <li><strong>repo</strong> - GitHub repository in "owner/repo" format</li>
      <li><strong>release</strong> - Specific release tag, or "latest" for most recent</li>
      <li><strong>require_sealed</strong> - If True, rejects attestations from unsealed VMs</li>
      <li><strong>timeout</strong> - HTTP request timeout in seconds</li>
    </ul>

    <h4>Returns</h4>
    <p>A <code>VerifiedClient</code> instance with standard HTTP methods.</p>

    <h4>Raises</h4>
    <ul>
      <li><code>VerificationError</code> - Quote verification failed</li>
      <li><code>AttestationNotFound</code> - No attestation in release</li>
      <li><code>UnsealedError</code> - VM is unsealed and require_sealed=True</li>
    </ul>

    <h3>VerifiedClient</h3>
    <p>HTTP client for verified endpoints. Supports all standard methods:</p>

    <pre data-lang="python"><code><span class="comment"># GET request</span>
response = client.<span class="function">get</span>(<span class="string">"/path"</span>, params={<span class="string">"key"</span>: <span class="string">"value"</span>})

<span class="comment"># POST with JSON</span>
response = client.<span class="function">post</span>(<span class="string">"/path"</span>, json={<span class="string">"data"</span>: <span class="string">"value"</span>})

<span class="comment"># PUT</span>
response = client.<span class="function">put</span>(<span class="string">"/path"</span>, data=<span class="string">"raw body"</span>)

<span class="comment"># DELETE</span>
response = client.<span class="function">delete</span>(<span class="string">"/path"</span>)

<span class="comment"># Custom headers</span>
response = client.<span class="function">get</span>(<span class="string">"/path"</span>, headers={<span class="string">"X-Custom"</span>: <span class="string">"value"</span>})</code></pre>

    <h4>Properties</h4>
    <pre data-lang="python"><code>client.endpoint      <span class="comment"># Verified endpoint URL</span>
client.attestation   <span class="comment"># Full attestation object</span>
client.rtmrs         <span class="comment"># RTMR measurements dict</span>
client.sealed        <span class="comment"># True if VM is sealed</span></code></pre>

    <h2>Error Handling</h2>
    <pre data-lang="python"><code><span class="keyword">from</span> easyenclave <span class="keyword">import</span> (
    connect,
    VerificationError,
    AttestationNotFound,
    UnsealedError,
    QuoteError,
)

<span class="keyword">try</span>:
    client = <span class="function">connect</span>(<span class="string">"owner/repo"</span>)
<span class="keyword">except</span> AttestationNotFound:
    print(<span class="string">"No attestation found in release"</span>)
<span class="keyword">except</span> UnsealedError:
    print(<span class="string">"VM is not sealed - use require_sealed=False for dev"</span>)
<span class="keyword">except</span> QuoteError <span class="keyword">as</span> e:
    print(<span class="string">f"TDX quote invalid: {e}"</span>)
<span class="keyword">except</span> VerificationError <span class="keyword">as</span> e:
    print(<span class="string">f"Verification failed: {e}"</span>)</code></pre>

    <h2>Development Mode</h2>
    <p>For local development with unsealed VMs:</p>

    <pre data-lang="python"><code><span class="comment"># Allow unsealed VMs (dev only!)</span>
client = <span class="function">connect</span>(
    <span class="string">"owner/repo"</span>,
    require_sealed=<span class="keyword">False</span>
)

<span class="comment"># Check if sealed</span>
<span class="keyword">if not</span> client.sealed:
    print(<span class="string">"WARNING: Connected to unsealed VM"</span>)</code></pre>

    <div class="callout callout-warning">
      <strong>Never use <code>require_sealed=False</code> in production!</strong>
      Unsealed VMs have SSH access and cannot guarantee code integrity.
    </div>

    <h2>Accessing Attestation Details</h2>
    <pre data-lang="python"><code>client = <span class="function">connect</span>(<span class="string">"owner/repo"</span>)

<span class="comment"># Get the full attestation</span>
attestation = client.attestation

print(<span class="string">f"Endpoint: {attestation.endpoint}"</span>)
print(<span class="string">f"Sealed: {attestation.sealed}"</span>)
print(<span class="string">f"Quote: {attestation.quote[:50]}..."</span>)

<span class="comment"># Check specific RTMRs</span>
<span class="keyword">for</span> name, value <span class="keyword">in</span> client.rtmrs.items():
    print(<span class="string">f"{name}: {value}"</span>)</code></pre>

    <h2>Custom Verification</h2>
    <p>For advanced use cases, access the verification primitives directly:</p>

    <pre data-lang="python"><code><span class="keyword">from</span> easyenclave.verify <span class="keyword">import</span> verify_quote, fetch_attestation

<span class="comment"># Fetch attestation manually</span>
attestation = <span class="function">fetch_attestation</span>(<span class="string">"owner/repo"</span>, release=<span class="string">"v1.0.0"</span>)

<span class="comment"># Verify the TDX quote</span>
result = <span class="function">verify_quote</span>(attestation.quote)

<span class="keyword">if</span> result.valid:
    print(<span class="string">"Quote verified!"</span>)
    print(<span class="string">f"TCB status: {result.tcb_status}"</span>)
<span class="keyword">else</span>:
    print(<span class="string">f"Verification failed: {result.error}"</span>)</code></pre>

    <h2>Examples</h2>

    <h3>Basic API Client</h3>
    <pre data-lang="python"><code><span class="keyword">from</span> easyenclave <span class="keyword">import</span> connect

<span class="keyword">def</span> <span class="function">main</span>():
    client = <span class="function">connect</span>(<span class="string">"myorg/secure-api"</span>)

    <span class="comment"># Health check</span>
    health = client.<span class="function">get</span>(<span class="string">"/health"</span>).json()
    print(<span class="string">f"Service status: {health['status']}"</span>)

    <span class="comment"># Make authenticated request</span>
    response = client.<span class="function">post</span>(
        <span class="string">"/api/process"</span>,
        json={<span class="string">"input"</span>: <span class="string">"sensitive data"</span>},
        headers={<span class="string">"Authorization"</span>: <span class="string">"Bearer token"</span>}
    )
    print(response.json())

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    <span class="function">main</span>()</code></pre>

    <h3>With Retry Logic</h3>
    <pre data-lang="python"><code><span class="keyword">import</span> time
<span class="keyword">from</span> easyenclave <span class="keyword">import</span> connect, VerificationError

<span class="keyword">def</span> <span class="function">connect_with_retry</span>(repo, max_retries=3):
    <span class="keyword">for</span> attempt <span class="keyword">in</span> range(max_retries):
        <span class="keyword">try</span>:
            <span class="keyword">return</span> <span class="function">connect</span>(repo)
        <span class="keyword">except</span> VerificationError <span class="keyword">as</span> e:
            <span class="keyword">if</span> attempt == max_retries - 1:
                <span class="keyword">raise</span>
            print(<span class="string">f"Attempt {attempt + 1} failed, retrying..."</span>)
            time.<span class="function">sleep</span>(2 ** attempt)

client = <span class="function">connect_with_retry</span>(<span class="string">"owner/repo"</span>)</code></pre>

    <h2>Next Steps</h2>
    <ul>
      <li><a href="concepts.html">Understand the trust model</a></li>
      <li><a href="action.html">Deploy your own service</a></li>
    </ul>
  </main>

  <footer>
    <p><a href="index.html">EasyEnclave</a> ¬∑ <a href="https://github.com/anthropics/easyenclave">GitHub</a></p>
  </footer>

  <script src="js/main.js"></script>
</body>
</html>
